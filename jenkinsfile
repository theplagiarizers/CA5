//This is Jenkins file for Member 2
//Path: jenkinsfile
//Objective: Create and upload the docker image of the web service by using the jenkinsfile
// stored in your branch.
pipeline {
    environment {
        registry = "theplagiarizers/ca5-web"
        registryCredential = 'dockerhub_id'
        dockerImage = ''
    }
    agent any

    stages {
        stage('Initialize') {
            steps {
                script {
                    def dockerHome = tool 'mydocker'
                    env.PATH = "${dockerHome}/bin:${env.PATH}"
                }
            }
        }
    stage('Building our image') {
        steps {
            echo 'Switching to web folder'
            dir('web') {
                sh 'ls'
                sh 'pwd'
                
                script {
                    dockerImage = docker.build registry + ":$BUILD_NUMBER"
                }
            }
        }
    }
    stage('Deploying image to dockerhub') {
        steps {
            script {
                docker.withRegistry( '', registryCredential ) {
                    dockerImage.push()
                }
            }
        }
    }
    stage('Remove Unused docker images') {
        steps {
            sh 'docker rmi $(docker images -f "dangling=true" -q)'
        }
    }
    }
}